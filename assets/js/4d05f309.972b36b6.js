"use strict";(self.webpackChunk_pdfme_website=self.webpackChunk_pdfme_website||[]).push([[9937],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=d(a),c=i,u=m["".concat(s,".").concat(c)]||m[c]||h[c]||l;return a?n.createElement(u,r(r({ref:t},p),{},{components:a})):n.createElement(u,r({ref:t},p))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:i,r[1]=o;for(var d=2;d<l;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},92142:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));const l={title:"Implementation Ideas for Dynamic Tables in pdfme",description:"Explore the innovative solutions for implementing dynamic tables in pdfme, a comprehensive guide discussing challenges, strategies, and ideas for advanced PDF table rendering, including page breaks, table styling, and layout calculations.",slug:"implementation-Ideas-for-dynamic-tables",authors:[{name:"Kyohei Fukuda (@hand-dot)",title:"Author of pdfme",url:"https://github.com/hand-dot",image_url:"https://avatars.githubusercontent.com/u/24843808?v=4"}],tags:[]},r=void 0,o={permalink:"/blog/implementation-Ideas-for-dynamic-tables",source:"@site/blog/2024-01-02-implementation-Ideas-for-dynamic-tables.md",title:"Implementation Ideas for Dynamic Tables in pdfme",description:"Explore the innovative solutions for implementing dynamic tables in pdfme, a comprehensive guide discussing challenges, strategies, and ideas for advanced PDF table rendering, including page breaks, table styling, and layout calculations.",date:"2024-01-02T00:00:00.000Z",formattedDate:"January 2, 2024",tags:[],readingTime:5.615,hasTruncateMarker:!0,authors:[{name:"Kyohei Fukuda (@hand-dot)",title:"Author of pdfme",url:"https://github.com/hand-dot",image_url:"https://avatars.githubusercontent.com/u/24843808?v=4",imageURL:"https://avatars.githubusercontent.com/u/24843808?v=4"}],frontMatter:{title:"Implementation Ideas for Dynamic Tables in pdfme",description:"Explore the innovative solutions for implementing dynamic tables in pdfme, a comprehensive guide discussing challenges, strategies, and ideas for advanced PDF table rendering, including page breaks, table styling, and layout calculations.",slug:"implementation-Ideas-for-dynamic-tables",authors:[{name:"Kyohei Fukuda (@hand-dot)",title:"Author of pdfme",url:"https://github.com/hand-dot",image_url:"https://avatars.githubusercontent.com/u/24843808?v=4",imageURL:"https://avatars.githubusercontent.com/u/24843808?v=4"}],tags:[]},prevItem:{title:"Developing pdfme V4",permalink:"/blog/developing-pdfme-v4"},nextItem:{title:"Why Develop a PDF Library Now?",permalink:"/blog/why-develop-pdf-library-now"}},s={authorsImageUrls:[void 0]},d=[{value:"Why Dynamic Tables Couldn&#39;t Be Implemented in pdfme",id:"why-dynamic-tables-couldnt-be-implemented-in-pdfme",level:2},{value:"How to Implement Page Breaks",id:"how-to-implement-page-breaks",level:2},{value:"How to Tackle the Complexity of Table Settings and Rendering",id:"how-to-tackle-the-complexity-of-table-settings-and-rendering",level:2},{value:"1. Table Styling",id:"1-table-styling",level:3},{value:"2. Setting Headers and Columns",id:"2-setting-headers-and-columns",level:3},{value:"3. Calculating Table Layout",id:"3-calculating-table-layout",level:3},{value:"I Would Appreciate Feedback",id:"i-would-appreciate-feedback",level:2}],p={toc:d},m="wrapper";function h(e){let{components:t,...l}=e;return(0,i.kt)(m,(0,n.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Contrary to the plan, we are working on the implementation of the dynamic table in a different way.\nPlease see the following blog article for the latest development information."),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/blog/developing-pdfme-v4"},"Developing pdfme V4")))),(0,i.kt)("h2",{id:"why-dynamic-tables-couldnt-be-implemented-in-pdfme"},"Why Dynamic Tables Couldn't Be Implemented in pdfme"),(0,i.kt)("p",null,"Until now, pdfme has been realizing simple ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Variable_data_printing"},"variable data printing")," by embedding PDF data into a property called ",(0,i.kt)("inlineCode",{parentName:"p"},"basePdf")," in the template and overlaying a ",(0,i.kt)("inlineCode",{parentName:"p"},"schema")," on top of this PDF."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://storage.googleapis.com/zenn-user-upload/b7b9c0b7611e-20240102.png",alt:"Image of the pdfme process"})),(0,i.kt)("p",null,"This method is incredibly simple and allows for the easy creation of customized PDFs."),(0,i.kt)("p",null,"However, there is a significant need that cannot be ignored for certain use cases in PDF creation.",(0,i.kt)("br",{parentName:"p"}),"\n","That need is table rendering. More specifically, many users want to address cases where the number of rows, like in the red-framed section of the image below, increases, such as in invoices."),(0,i.kt)("img",{src:"https://storage.googleapis.com/zenn-user-upload/53a9a0a584fc-20240102.png",width:"500px"}),(0,i.kt)("p",null,"The method of overlaying a schema on the basePdf, as explained above, doesn't allow for an efficient implementation of page breaks."),(0,i.kt)("p",null,"Therefore, the current version of pdfme cannot support tables where rows dynamically increase."),(0,i.kt)("p",null,"I understand this need but was struggling with how exactly to implement it.",(0,i.kt)("br",{parentName:"p"}),"\n","This has been the main blocker in implementing Tables."),(0,i.kt)("h2",{id:"how-to-implement-page-breaks"},"How to Implement Page Breaks"),(0,i.kt)("p",null,"I've been ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pdfme/pdfme/discussions/148"},"discussing")," this with users for quite some time, and finally, there seems to be a way to implement page breaks. Two key elements have come together:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ReadOnly Schemas added in ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/pdfme/pdfme/releases/tag/3.2.0"},"V3.2.0"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Line, Rectangle, Ellipse, SVG, Text, Image"))),(0,i.kt)("li",{parentName:"ul"},"A new way to specify basePdf and padding implemented for ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/pdfme/pdfme/pull/394"},"V4"),", called ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/pdfme/pdfme/blob/c4dfa7023a42d9ab207784a6557f902c078bdcd6/packages/common/src/schema.ts#L87"},"BlankPDF"))),(0,i.kt)("p",null,"With ReadOnly Schemas, it's possible to design the static parts of a template within pdfme without loading a PDF designed in basePdf. This allows for the addition of the height of schemas added to the page, adjusting the y-coordinate of all schemas below it by the increased height. Padding also allows control over where to resume rendering after a page break."),(0,i.kt)("p",null,"The following figure shows an example where 19 rows of table data are provided, causing a page break, and the 'note' schema being pushed down."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Example of table with page break",src:a(52815).Z,width:"4705",height:"3766"})),(0,i.kt)("p",null,"The logic I had in mind was:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Render the table one row at a time, from Header to Row19."),(0,i.kt)("li",{parentName:"ul"},"As the height increases and spills over the first page at Row 12, a page break occurs, creating a second page."),(0,i.kt)("li",{parentName:"ul"},"After rendering up to Row19, the generator function returns the final height of the table, which is retained in a variable like yAdjust (190mm in the figure above)."),(0,i.kt)("li",{parentName:"ul"},"For all schemas below the increased height schema (in this example, 'note'), add the increased height (190mm) to their y-coordinate. The rendering starts on the second page at a y-coordinate of 140mm.")),(0,i.kt)("p",null,"The issue is that it doesn't accommodate fixed layouts like headers or footers. In that case, instead of specifying the size of ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pdfme/pdfme/blob/c4dfa7023a42d9ab207784a6557f902c078bdcd6/packages/common/src/schema.ts#L87"},"BlankPDF"),"'s width and height, specify a PDF containing the fixed design of the header or footer. This is planned for further modification."),(0,i.kt)("h2",{id:"how-to-tackle-the-complexity-of-table-settings-and-rendering"},"How to Tackle the Complexity of Table Settings and Rendering"),(0,i.kt)("p",null,"Table settings and rendering can get complex. How should we approach it?",(0,i.kt)("br",{parentName:"p"}),"\n","I want to leverage the simplicity of pdfme, which allows for easy PDF creation, to implement the table functionality."),(0,i.kt)("p",null,"For example, consider how to set up the following table."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://storage.googleapis.com/zenn-user-upload/5607ddfc06c7-20240102.png",alt:"Example of a complex table"})),(0,i.kt)("p",null,"A table is essentially composed of headers (th) and table data (td).",(0,i.kt)("br",{parentName:"p"}),"\n","Table data may be rendered in something other than text. In this example, ",(0,i.kt)("inlineCode",{parentName:"p"},"Name")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Category")," columns are rendered with a Text renderer, while ",(0,i.kt)("inlineCode",{parentName:"p"},"Image")," column is rendered with an Image renderer."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Fortunately, pdfme already implements various renderers like Text, Image, SVG, Barcodes, etc. Therefore, there's no need to create new rendering processes for each cell; once the size and position of a cell are determined, existing PDF rendering processes can be used.")),(0,i.kt)("p",null,"This leverages the plugin architecture of pdfme's rendering processes, potentially simplifying complex tasks."),(0,i.kt)("p",null,"This idea came from an ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pdfme/pdfme/issues/332#issuecomment-1872032370"},"interesting comment")," left by ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/MP70"},"MP70")," on the dynamic table issue.",(0,i.kt)("br",{parentName:"p"}),"\n","Considering the above, I believe the table should do the following three things:"),(0,i.kt)("h3",{id:"1-table-styling"},"1. Table Styling"),(0,i.kt)("p",null,"The following image shows a QR code setting panel, but similar style settings should be possible for tables as well."),(0,i.kt)("img",{src:"https://storage.googleapis.com/zenn-user-upload/9444827add81-20240102.png",width:"500px"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Border",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"color, width"))),(0,i.kt)("li",{parentName:"ul"},"Cell Padding (content margin)",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"horizontal, vertical"))),(0,i.kt)("li",{parentName:"ul"},"Cell Background Color",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Plan to implement a stripe design, alternating odd and even rows"))),(0,i.kt)("li",{parentName:"ul"},"Header Visibility")),(0,i.kt)("h3",{id:"2-setting-headers-and-columns"},"2. Setting Headers and Columns"),(0,i.kt)("p",null,"Add columns to the header and set how they will be rendered."),(0,i.kt)("img",{src:"https://storage.googleapis.com/zenn-user-upload/560ebea7ca2e-20240102.png",width:"500px"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Each column is rendered with ",(0,i.kt)("inlineCode",{parentName:"li"},"ReadOnlyText"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Options available in the existing Text renderer like text color and background color can be used"))),(0,i.kt)("li",{parentName:"ul"},"Specify Type to set up rendering of table data",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Use renderers available in pdfme like Image, Barcodes, etc., as types"))),(0,i.kt)("li",{parentName:"ul"},"Clicking the gear icon in the image above opens a modal to set the Column and Type")),(0,i.kt)("h3",{id:"3-calculating-table-layout"},"3. Calculating Table Layout"),(0,i.kt)("p",null,"Once the style and column rendering settings are determined, calculate the layout and render the cells."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Calculating and rendering cell positions",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Generally, render at the same x-coordinate as each column, but use the y-coordinate and height of the row above for the y-coordinate. Once the position is set, render the cell using the column settings."))),(0,i.kt)("li",{parentName:"ul"},"Calculating the height of Rows and Cells",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"As explained in the page break section, the increased height needs to be communicated to the generator function."),(0,i.kt)("li",{parentName:"ul"},"As a current issue, the Text renderer, if not using the Dynamic Font Size feature, might render beyond the set height, as shown in the image below.\n",(0,i.kt)("img",{parentName:"li",src:"https://storage.googleapis.com/zenn-user-upload/2f880c86b4fd-20240102.png",alt:"Text rendering spilling over set height"})),(0,i.kt)("li",{parentName:"ul"},"Ideally, the row height should be expanded, as shown in the image below. To achieve this, the Text renderer needs to return the rendered height after rendering.",(0,i.kt)("img",{src:"https://storage.googleapis.com/zenn-user-upload/3b7065ee2f39-20240102.png",width:"500px"})),(0,i.kt)("li",{parentName:"ul"},"The height of each cell's rendering result determines the height of each Row, and the total height of all Rows determines the height of the table.")))),(0,i.kt)("h2",{id:"i-would-appreciate-feedback"},"I Would Appreciate Feedback"),(0,i.kt)("p",null,"The implementation of the table hasn't started yet. Right now, it's just the ideas written in this document.",(0,i.kt)("br",{parentName:"p"}),"\n","I believe there are many oversights and issues with these ideas."),(0,i.kt)("p",null,"Being an OSS, I hope it gets seen by many and receives feedback and collaboration. If there seem to be any issues, please let me know.",(0,i.kt)("br",{parentName:"p"}),"\n","The dynamic table issue is here. Feel free to comment.",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pdfme/pdfme/issues/332"},"https://github.com/pdfme/pdfme/issues/332")),(0,i.kt)("p",null,"And thank you for reading until the end.",(0,i.kt)("br",{parentName:"p"}),"\n","If you want to support this project, the easiest way to contribute is to share this article.",(0,i.kt)("br",{parentName:"p"}),"\n","I look forward to your continued support for pdfme."))}h.isMDXComponent=!0},52815:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dynamictable-eb7022dddcbdde6eb391b60f751ae4a1.png"}}]);