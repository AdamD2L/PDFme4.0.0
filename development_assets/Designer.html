<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Webpack App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body style="margin: 0">
    <div>
      <a href="./">Back</a>
      /
      <button onclick="init()">init</button>
      /
      <button onclick="destroy()">destroy</button>
      /
      <button onclick="saveTemplate()">saveTemplate</button>
      /
      <button onclick="updateTemplate()">updateTemplate</button>
      /
      <button onclick="generate()">generate</button>
      /
      <label>
        loadTemplate
        <input type="file" accept="application/json" onchange="loadTemplate(this.files[0])" />
      </label>
    </div>
    <div id="app"></div>
    <!-- index.js is dist/index.js -->
    <script src="./index.js"></script>
    <script src="./helper.js"></script>
    <script>
      let editor = null;

      async function init() {
        const font = await getFont();
        editor = new pdfme.Designer({
          domContainer,
          template: getTemplate(),
          options: {
            font,
          },
        });

        editor.onSaveTemplate((t) => {
          console.log({ ...t, basePdf: 'skip...' });
          const tj = JSON.stringify(t, null, 2);
          localStorage.setItem('template', tj);
        });
      }

      function destroy() {
        editor.destroy();
      }

      function saveTemplate() {
        editor.saveTemplate();
      }

      function updateTemplate() {
        editor.updateTemplate(getSampleTemplate());
      }

      function loadTemplate(file) {
        const reader = new FileReader();
        reader.onload = () => {
          editor.updateTemplate(JSON.parse(reader.result));
        };
        reader.readAsText(file);
      }

      async function generate() {
        const font = await getFont();
        const template = editor.getTemplate();
        const inputs = template.sampledata;
        pdfme
          .generate({
            inputs,
            template,
            options: {
              font,
            },
          })
          .then((pdf) => {
            const blob = new Blob([pdf.buffer], { type: 'application/pdf' });
            window.open(URL.createObjectURL(blob));
          });
      }

      window.onload = init;
    </script>
  </body>
</html>
